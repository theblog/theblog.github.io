const ANIMATE_INTERVAL_MILLIS=50,DATASET_DEFAULTS={wiki:{steps:500,maxSentences:3,prime:"The"},congress:{steps:500,maxSentences:50,prime:"The"},southPark:{steps:500,maxSentences:3,prime:"Oh my god"},sherlock:{steps:500,maxSentences:3,prime:"The"},goethe:{steps:500,maxSentences:50,prime:"Der"}},SEND_ON_ENTER=!1,USE_LOCAL_CACHE=!0;let TEXT_INPUTS=$(".text-input"),TEXT_INPUT_DESKTOP=$(".talk-box:not(.mobile) .text-input"),TEXT_INPUT_MOBILE=$(".talk-box.mobile .text-input"),TEXT_OUTPUT=$(".text-output"),TEXT_BRIDGE=$(".text-input-output-bridge"),TALK_BOX_HEADING=$(".talk-box-heading"),DATASET_DROPDOWN=$("#talk-box-dataset-dropdown"),selectedDataset=null,pendingRequestId=null,result=null;function selectDataset(t){selectedDataset=null==t?DATASET_DROPDOWN.find(".dropdown-toggle").val():t,TALK_BOX_HEADING.find("button.active").removeClass("active"),TALK_BOX_HEADING.find('button[value="'+selectedDataset+'"]').addClass("active");let e=DATASET_DROPDOWN.find('a[data-value="'+selectedDataset+'"]');selectDropdownItem(e,!1),TEXT_INPUTS.html(DATASET_DEFAULTS[selectedDataset].prime),TEXT_OUTPUT.html(""),focusOnInput()}function onInput(){let t=getCleanInput();getTextInputElem(!1).html(t),TEXT_OUTPUT.html().length&&(TEXT_BRIDGE.hide(),TEXT_OUTPUT.slideToggle({start:()=>TEXT_OUTPUT.html(""),always:()=>TEXT_OUTPUT.show()}))}function getCleanInput(){let t=getTextInputElem().html();return t=t.replace(/<div>(?!<br)/g,"<div><br/>"),t=t.replace(/<br ?\/?>/g,"\n"),t=t.replace(/<\/?\w*?\/?>/g,""),t=he.decode(t),t}function completeText(){$("#send-button").focus();let t=$.trim(getCleanInput());if(!t.length)return;const e=PostUtil.generateUUID();pendingRequestId=e,animateWaiting(e);const n=DATASET_DEFAULTS[selectedDataset],T=t=>{pendingRequestId===e&&(result=t,pendingRequestId=null)};completeTextWithCache(t,n.steps,n.maxSentences,selectedDataset,T)}function getNumToAdd(t){return t<300?1:0}function getRandomChange(t){const e=getNumToAdd(t.length);let n=0;for(;n<e;){const T=e-n;(T>1||Math.random()<T)&&(t+=Math.random()<.167?" ":PostUtil.getRandomCharacter()),n+=1}return t.split("").map(t=>" "===t?t:Math.random()<=.2?PostUtil.getRandomCharacter():t).join("")}function animateResult(t,e){const n=e.getTime()-(new Date).getTime();if(n<=0)return TEXT_OUTPUT.html(t),void focusOnInput();let T=TEXT_OUTPUT.html();const a=Math.ceil(n/50),l=t.length-T.length;if(l>0){const t=Math.ceil(l/a);T+=PostUtil.getRandomSentence(t)}else if(l<0){const t=Math.ceil(-l/a);T=T.substr(0,T.length-t)}const s=[];Array.from(T).forEach((e,n)=>{n<t.length&&e!==t[n]&&s.push(n)});const i=Math.ceil(s.length/a);_.sample(s,i).forEach(e=>{T=T.substr(0,e)+t[e]+T.substr(e+1)}),TEXT_OUTPUT.html(T),setTimeout(()=>animateResult(t,e),50)}function animateWaiting(t){TEXT_OUTPUT.show(),TEXT_BRIDGE.show(),TEXT_OUTPUT.html("a"),setTimeout(()=>refreshAnimateWaiting(t),50)}function refreshAnimateWaiting(t){if(pendingRequestId===t)TEXT_OUTPUT.html(getRandomChange(TEXT_OUTPUT.html())),setTimeout(()=>refreshAnimateWaiting(t),50);else if(null==pendingRequestId){const t=new Date((new Date).getTime()+1e3);animateResult(result,t)}}function focusOnInput(){let t=getTextInputElem();t.is(":focus")||PostUtil.placeCaretAtEnd(t.get(0))}function getTextInputElem(t=!0){let e=TEXT_INPUT_MOBILE.is(":visible");return t&&e||!t&&!e?TEXT_INPUT_MOBILE:TEXT_INPUT_DESKTOP}$((function(){TEXT_INPUTS=$(".text-input"),TEXT_INPUT_DESKTOP=$(".talk-box:not(.mobile) .text-input"),TEXT_INPUT_MOBILE=$(".talk-box.mobile .text-input"),TEXT_OUTPUT=$(".text-output"),TEXT_BRIDGE=$(".text-input-output-bridge"),TALK_BOX_HEADING=$(".talk-box-heading"),DATASET_DROPDOWN=$("#talk-box-dataset-dropdown"),selectedDataset=null,pendingRequestId=null,result=null,selectDataset("congress")}));